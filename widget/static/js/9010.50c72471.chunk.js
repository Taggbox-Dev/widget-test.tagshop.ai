"use strict";(self.webpackChunkembed_widget=self.webpackChunkembed_widget||[]).push([[9010],{18748:(e,t,i)=>{i.r(t),i.d(t,{Loader:()=>S,default:()=>b});var s=i(47313),a=i(31881),o=i.n(a),l=i(68375),r=(i(19161),i(30192)),d=i.n(r),n=i(66266),p=i.n(n),c=i(35179);const h=c.ig?"cloud.tagshop.ai":"cloud.tagbox.com";const u=class{constructor(e,t,i){let s="media/tmpimages/",a=h;c.nX&&(s="ugc-suite/tmp/",a="cloud.tagbox.com"),c.ig&&(s="tmp/"),this.uppy=new(d())({meta:{type:"avatar"},autoProceed:!0,debug:!0,allowMultipleUploads:!0,restrictions:{maxFileSize:104857600,maxNumberOfFiles:i||1,minNumberOfFiles:1,allowedFileTypes:["image/*","video/*"]},onBeforeFileAdded:e,onBeforeUpload:t}),this.uppy.use(p(),{params:{auth:{key:"0701d3d7f8d94e92a65a9cba388b1d96"},steps:{store:{robot:"/wasabi/store",bucket_region:"us-west-1",result:!0,bucket:a,key:"47ABVORKG52UYE1KB28S",secret:"pcaTfeokaz28geAAns08H3yaGbOVz6ILgTptu19v",path:s+"${file.id}.${file.ext}"}}},waitForEncoding:!0})}};var m=i(17739),g=i(98501),x=i(16031),f=i.n(x),y=i(46417);const S=e=>{let{value:t,isBar:i}=e;const s=Math.round((100-t)/100*182.12);return i?(0,y.jsx)("div",{className:"t_m_pb_wrap",children:(0,y.jsx)("div",{className:"t_m_pb",style:{width:"".concat(t,"%")},children:(0,y.jsx)("div",{})})}):(0,y.jsx)("div",{className:"t_m_propgress",children:(0,y.jsxs)("svg",{width:"78",height:"78",viewBox:"-10 -10 100 100",version:"1.1",xmlns:"http://www.w3.org/2000/svg",style:{transform:"rotate(-90deg)"},children:[(0,y.jsx)("circle",{r:"30",cx:"40",cy:"40",fill:"transparent",stroke:"#D9D9D9",strokeWidth:"4",strokeDasharray:"188.4px",strokeDashoffset:"0"}),(0,y.jsx)("circle",{id:"path_fr_circle",r:"30",cx:"40",cy:"40",stroke:"#545454",strokeWidth:"4",strokeLinecap:"butt",strokeDashoffset:"".concat(s,"px"),fill:"transparent",strokeDasharray:"188.4px"}),(0,y.jsxs)("text",{x:"25px",y:"47px",fill:"#545454",fontSize:"14px",style:{transform:"rotate(90deg) translate(17px, -84px)"},textAnchor:"middle",dominantBaseline:"middle",children:[t,"%"]})]})})};class w extends s.Component{constructor(){super(...arguments),this.state={isLoading:!1,selectedFile:null,selectedUrl:null,type:null,thumb_file:[],fileSize:!1,filemaxSize:0,throwError:!1,videoPath:"",fileSizeText:"",ext:null,size:0,fileName:null,mediaHeight:0,mediaWidth:0,uploadPercent:0,limit:20,uploadedFiles:[]},this.beforeFileAdded=(e,t)=>{(0,m.AB)(1);const{size:i,sizeText:s}=(0,m.RD)(e.size);if(["GB","TB"].includes(s)){const t=e.meta.type.includes("image")?4:5;this.setState({type:t,fileSize:!0,fileSizeText:"".concat(i).concat(s)},(()=>{this.onLoadError(t),setTimeout((()=>this.setState({fileSize:!1,fileSizeText:""})),2e3)})),(0,m.AB)(2)}else if("MB"==s){const t=e.meta.type.includes("image")?4:5,l=4==t?15:100;if(i>=l)return this.setState({type:t,filemaxSize:l,fileSize:!0,fileSizeText:"".concat(i).concat(s)},(()=>{this.onLoadError(t),setTimeout((()=>this.setState({fileSize:!1,fileSizeText:"",type:null},(()=>this.onLoadError(t)))),5e3)})),(0,m.AB)(2),!1;if(e.meta&&e.meta.type.includes("video")){try{const{onsite_token:t}=this.props;this.setState({isLoading:!0});const i=e,s=new FormData;s.append("file",i.data),s.append("onsite_token",t);const a={headers:{productdomain:"taggbox.com"},onUploadProgress:e=>{const t=Math.round(100*e.loaded/e.total);this.setState({uploadPercent:t,isLoading:!0})}};o().post(c.so,s,a).then((e=>{const{responseData:t}=e.data;t&&t.length>0&&(this.setState((e=>({videoPath:t[0].sscode,isLoading:!1,type:5,selectedFile:t[0].s3Url,selectedUrl:t[0].s3Url,thumb_file:t[0].s3ThumbUrl,ext:i.extension,size:i.size,fileName:i.name,mediaHeight:t[0].height,mediaWidth:t[0].width})),(()=>this.onUpdateLocalState())),(0,m.AB)(2))})).catch((e=>{this.setState({isLoading:!1,throwError:!0},(()=>setTimeout((()=>this.setState({throwError:!1})),2e3))),(0,m.AB)(2)}))}catch(a){this.setState({isLoading:!1,throwError:!0},(()=>setTimeout((()=>this.setState({throwError:!1})),2e3))),this.uppyUploader.uppy.reset(),(0,m.AB)(2)}return!1}}},this.beforeUpload=e=>{this.setState({isLoading:!0})},this.uppyUploader=new u(this.beforeFileAdded,this.beforeUpload,this.state.limit),this.onRemovedState=e=>{const{type:t}=this.state;this.setState({selectedFile:null,selectedUrl:null,type:null,thumb_file:"",fileSize:!1,fileSizeText:"",videoPath:"",ext:null,size:0,fileName:null,mediaHeight:0,mediaWidth:0},(()=>{this.onLoadError(t),e&&this.uppyUploader.uppy.reset()}))},this.onUpdateLocalState=()=>{const{addPostImage:e,isActiveIndex:t}=this.props,{selectedUrl:i,type:s,thumb_file:a,videoPath:o,ext:l,size:r,fileName:d,mediaHeight:n,mediaWidth:p,uploadedFiles:c}=this.state;e(i,5===s?a:i,o,s,t,l,r,d,n,p),5===s&&this.onRemovedState(!1)},this.onLoadError=e=>{const{uploadErrorCallback:t}=this.props,{fileSize:i,fileSizeText:s,filemaxSize:a,throwError:o}=this.state,l=i?"File Size (".concat(s,") Limit Exceeded ").concat(4==e?"Image":"Video"," Size : Max ").concat(a," MB"):"",r=o?"Something went wrong , Please try again.":"";t(l||(r||""))}}componentDidMount(){this.uppyUploader.uppy.on("transloadit:result",((e,t)=>{this.setState({isLoading:!1});const i=t.meta.orientation&&"Rotate 90 CW"==t.meta.orientation?t.meta.width:t.meta.height,s=t.meta.orientation&&"Rotate 90 CW"==t.meta.orientation?t.meta.height:t.meta.width;let a="".concat(g.ho,"media/tmpimages/");c.nX&&(a="https://cloud.tagbox.com/ugc-suite/tmp/"),c.ig&&(a="https://cloud.tagshop.ai/tmp/"),this.setState((e=>({type:t.mime.includes("video")?5:4,selectedFile:t.id,selectedUrl:"".concat(a).concat(t.id,".").concat(t.ext),ext:t.ext,size:t.size,fileName:t.name,mediaHeight:i,mediaWidth:s,uploadedFiles:[...e.uploadedFiles,{name:t.name,url:"".concat(a).concat(t.id,".").concat(t.ext)}]})),(()=>this.onUpdateLocalState())),(0,m.AB)(2)})),this.uppyUploader.uppy.on("file-removed",((e,t)=>{(0,m.AB)(2)})),this.uppyUploader.uppy.on("upload-progress",((e,t)=>{this.setState({uploadPercent:(t.bytesUploaded/t.bytesTotal*100).toFixed()})})),this.uppyUploader.uppy.on("upload-error",((e,t)=>{this.setState({throwError:!0})})),this.uppyUploader.uppy.on("upload-complete",((e,t)=>{this.onRemovedState(!0)}))}componentDidUpdate(e){const{removedFile:t}=this.props;let{uploadedFiles:i}=this.state;if(!f().isEqual(t,e.removedFile)){const e=this.uppyUploader.uppy.getFiles();if(e.length>0){const s=i.find((e=>e.url==t.video));if(s&&Object.keys(s).length>0){const i=e.find((e=>e.name==s.name));this.uppyUploader.uppy.removeFile(i.id),this.setState((e=>({uploadedFiles:e.uploadedFiles.filter((e=>e.url!==t.video))})))}}}}render(){const{isLoading:e,fileSize:t,throwError:i,fileSizeText:s,filemaxSize:a,type:o,uploadPercent:r,limit:d}=this.state,{upload_image:n}=this.props;return n&&n.length<20?(0,y.jsx)(y.Fragment,{children:(0,y.jsx)("div",{className:"t_m_upload ".concat(n&&n.length<1?"t_m_dd":""),children:(0,y.jsx)("div",{className:"t_m_up_wrp",children:n&&n.length<1?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(l.v0,{note:"Video Size : Max 100MB | Photo Size : Max 15MB | Max 20 Posts",uppy:this.uppyUploader.uppy,inline:!0,maxNumberOfFiles:d,width:"100%",height:"auto",locale:{strings:{dropHereOr:"Drag a video / image to upload (optional)",browse:""}}}),e?(0,y.jsx)(S,{value:r,isBar:!0}):null]}):e?(0,y.jsx)(S,{value:r,isBar:!1}):(0,y.jsx)(y.Fragment,{children:(0,y.jsx)(l.S2,{uppy:this.uppyUploader.uppy,allowMultipleFiles:!0,locale:{strings:{browse:"browse"}}})})})})}):null}}const b=w}}]);